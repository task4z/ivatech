import { HttpClient } from '@angular/common/http';
import { TestBed } from '@angular/core/testing';
import { of } from 'rxjs';
import { DashboardHelper } from 'src/app/models/dashboard-helper.model';
import { Dashboard } from 'src/app/models/dashboard.model';

import { DashboardService } from './dashboard.service';

describe('DashboardService', () => {
  let service: DashboardService;

  let httpClientSpy: jasmine.SpyObj<HttpClient>;
  beforeEach(() => {
    httpClientSpy = jasmine.createSpyObj('HttpClient', ['get']);
    TestBed.configureTestingModule({
      providers: [
        { provide: HttpClient, useValue: httpClientSpy },
      ]
    });
    service = TestBed.inject(DashboardService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });

  it('should return expected dashboard (HttpClient called once)', (done: DoneFn) => {
    const returnedDashboard: Dashboard = {
      dashboard: {
        bestsellers: [{ product: { id: "e2414f21-2647-c4aa-748a-81dc838db74a", image: "https://images.unsplash.com/photo-1463860914822-61dc3ee606f7?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Cartoon Network Studios Lime Flower Youngberry Gummies" }, revenue: 2835702, units: 6178 }, { product: { id: "99564712-9bb0-fc90-aae4-5d7dcc6dd35a", image: "https://images.unsplash.com/photo-1463860914822-61dc3ee606f7?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Magik Lamp Jasmine Flowers Cowberry Drops" }, revenue: 1798368, units: 4323 }, { product: { id: "54cde370-ebf7-2895-113d-0c327c11d97a", image: "https://images.unsplash.com/photo-1463860914822-61dc3ee606f7?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Profitpros Licorice, Liquorice Cocky Apple Snack" }, revenue: 3665331, units: 3669 }, { product: { id: "07f4f715-b8c5-a308-0cbf-49fe627a8d59", image: "https://images.unsplash.com/photo-1463860914822-61dc3ee606f7?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Vermeer Industries Peppermint Raspberry Candy" }, revenue: 3809712, units: 6852 }, { product: { id: "07d109f3-ef17-6e01-aaa6-9d0e30300ccb", image: "https://images.unsplash.com/photo-1463860914822-61dc3ee606f7?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Gap Safflower European Blueberry Drops" }, revenue: 1280610, units: 4743 }, { product: { id: "194b82ca-3947-d38e-1509-56f942c86004", image: "https://images.unsplash.com/photo-1472452049192-db15def0be25?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Drs Technologies Aniseed Myrtle Huckleberry Snack" }, revenue: 1688960, units: 5824 }, { product: { id: "f3e61ceb-3b9f-8f06-6ff7-d65fe27a434f", image: "https://images.unsplash.com/photo-1472452049192-db15def0be25?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Est\u00e9e Lauder Companies Licorice, Liquorice Amelanchier Drops" }, revenue: 4477278, units: 4758 }, { product: { id: "9033b5e3-c991-16d9-50fa-7a3836032105", image: "https://images.unsplash.com/photo-1472452049192-db15def0be25?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Chargepal Cudweed Myrciaria Floribunda Drops" }, revenue: 5116287, units: 8657 }, { product: { id: "d0fa8777-5066-4bd2-bd1c-6bc231922aad", image: "https://images.unsplash.com/photo-1472452049192-db15def0be25?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Chrysler Pandan Flower Keule Cotton Candy" }, revenue: 5119303, units: 8113 }, { product: { id: "0ef473de-ad65-59e8-6689-a8971000c6bf", image: "https://images.unsplash.com/photo-1472452049192-db15def0be25?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "S3 Graphics Jimbu Black Sapote Cotton Candy" }, revenue: 5000610, units: 5377 }, { product: { id: "0d259437-f35f-a15a-5c80-f9d065b4bf71", image: "https://images.unsplash.com/photo-1542310503-ff8da9c02372?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Iron Mountain Artemisia Lime Gummies" }, revenue: 2858368, units: 4384 }, { product: { id: "4a9a79a5-1a8c-3e0e-3f57-c503a38eb47c", image: "https://images.unsplash.com/photo-1542310503-ff8da9c02372?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Starbucks Avens Berberis Snack" }, revenue: 4605202, units: 9266 }, { product: { id: "00aae6d2-bfea-71ee-d51b-f0ef49c60a77", image: "https://images.unsplash.com/photo-1542310503-ff8da9c02372?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Starbucks Culantro Raisin Gum" }, revenue: 1635270, units: 5990 }, { product: { id: "2c3341fd-3841-9da1-58cb-6917845b5d7c", image: "https://images.unsplash.com/photo-1542310503-ff8da9c02372?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Greyvoid Artemisia Dodder Laurel Gum" }, revenue: 4765940, units: 7687 }, { product: { id: "aee9992f-d535-8f1f-3fb4-fc757a76bc45", image: "https://images.unsplash.com/photo-1542310503-ff8da9c02372?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Better Business Ideas And Services Dorrigo Jostaberry Bar" }, revenue: 1493184, units: 3333 }, { product: { id: "d4794480-b413-d908-59aa-ff94d49e4b44", image: "https://images.unsplash.com/photo-1532117364815-720cd35ff6e3?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Chargepal Alligator Pepper Youngberry Gummies" }, revenue: 3741950, units: 5585 }, { product: { id: "5bd30011-c890-6941-2f82-b14a6bd0f744", image: "https://images.unsplash.com/photo-1532117364815-720cd35ff6e3?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Asian Junction Salep Cocky Apple Pretzels" }, revenue: 2156605, units: 3817 }, { product: { id: "079a056e-4d9e-c79c-9f66-7833aa71aba7", image: "https://images.unsplash.com/photo-1532117364815-720cd35ff6e3?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Creative Wealth Management Catnip Calamansi Candy" }, revenue: 6417408, units: 8356 }, { product: { id: "7ab1ab4d-def0-3803-b960-a0258ef1472e", image: "https://images.unsplash.com/photo-1532117364815-720cd35ff6e3?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Enviro Architectural Designs Aniseed Myrtle Tomatillo Bar" }, revenue: 4474974, units: 9114 }, { product: { id: "1521aea2-9c1a-c2a7-2fe2-79a8f91c44dc", image: "https://images.unsplash.com/photo-1532117364815-720cd35ff6e3?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Lucasfilm Peruvian Pepper Date Snack" }, revenue: 2052891, units: 3753 }, { product: { id: "d900aa29-717e-cfbc-9632-ffba085a853e", image: "https://images.unsplash.com/photo-1507032248589-d4fabcffff6c?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Walmart Avens Keule Snack" }, revenue: 3093580, units: 5815 }, { product: { id: "dda3a02d-6bdc-dbe6-7494-edbdb62d5ac0", image: "https://images.unsplash.com/photo-1507032248589-d4fabcffff6c?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Cna Cicely, Sweet Cicely Desert Fig Cotton Candy" }, revenue: 1409624, units: 3749 }, { product: { id: "ec8a9747-352c-4a34-50ce-46d2b21bfb12", image: "https://images.unsplash.com/photo-1507032248589-d4fabcffff6c?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Geico Curry Plant Calamansi Bar" }, revenue: 6222306, units: 6906 }, { product: { id: "33000023-80f0-48cb-cb86-a9df2bb3086d", image: "https://images.unsplash.com/photo-1507032248589-d4fabcffff6c?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Washburn Guitars Saffron Myrciaria Floribunda Pretzels" }, revenue: 3530100, units: 8610 }, { product: { id: "1968e98c-22b5-ef0b-a3b9-c8de3526aa14", image: "https://images.unsplash.com/photo-1507032248589-d4fabcffff6c?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Jetblue Airways Barberry Melon Pear Snack" }, revenue: 5990733, units: 9837 }, { product: { id: "357b9977-7599-990b-245b-e180125973ca", image: "https://images.unsplash.com/photo-1484328577761-18c07a30344a?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Gamma Realty Peruvian Pepper Camu Camu Bar" }, revenue: 947400, units: 4737 }, { product: { id: "3cab48fe-90ab-7703-bef2-cb21accc0e76", image: "https://images.unsplash.com/photo-1484328577761-18c07a30344a?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Magik Lamp Lesser Calamint Banana Gummies" }, revenue: 2606800, units: 6860 }, { product: { id: "ea98ba03-610b-5d12-daa0-b6d0ac5a8ed6", image: "https://images.unsplash.com/photo-1484328577761-18c07a30344a?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Musco Lighting Cinnamon Myrtle Dwarf Dangleberry Gum" }, revenue: 5629800, units: 9383 }, { product: { id: "48c93523-c3f4-affd-eb05-d2f8c0f0ba73", image: "https://images.unsplash.com/photo-1484328577761-18c07a30344a?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Brown-Forman Corporation Caper Blood Orange Cotton Candy" }, revenue: 990600, units: 7620 }, { product: { id: "ba9e072a-9457-345d-7ffa-1be961014ddb", image: "https://images.unsplash.com/photo-1484328577761-18c07a30344a?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=500&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=500", name: "Vaughan & Bushnell Manufacturing Licorice, Liquorice Citron Pretzels" }, revenue: 8593176, units: 9677 }],
        sales_over_time_week: { 1: { orders: 96, total: 27 }, 2: { orders: 31, total: 74121 }, 3: { orders: 52, total: 180284 }, 4: { orders: 34, total: 115600 }, 5: { orders: 67, total: 333325 }, 6: { orders: 57, total: 374262 }, 7: { orders: 26, total: 35672 } },
        sales_over_time_year: { 1: { orders: 330, total: 2952510 }, 10: { orders: 746, total: 2322298 }, 11: { orders: 5424, total: 16863216 }, 12: { orders: 680, total: 3198040 }, 2: { orders: 745, total: 7034290 }, 3: { orders: 687, total: 6486654 }, 4: { orders: 311, total: 1593253 }, 5: { orders: 44, total: 166452 }, 6: { orders: 403, total: 3514966 }, 7: { orders: 342, total: 1870398 }, 8: { orders: 696, total: 2628096 }, 9: { orders: 279, total: 1401138 } }
      }
    };
    const expectedDashboard: DashboardHelper = {
      header: [{ label: "Today", total: "$27", orders: 96 },
      { label: "Last Week", total: "$1113K", orders: "363" },
      { label: "Last Month", total: "$2953K", orders: 330 }],
      lastSevenDays: [{ name: "today", value: 27 }, { name: "yesterday", value: 74121 }, { name: "day 3", value: 180284 }, { name: "day 4", value: 115600 }, { name: "day 5", value: 333325 }, { name: "day 6", value: 374262 }, { name: "day 7", value: 35672 }],
      lastTwelveMonths: [{ name: "this month", value: 2952510 }, { name: "last month", value: 7034290 }, { name: "month 3", value: 6486654 }, { name: "month 4", value: 1593253 }, { name: "month 5", value: 166452 }, { name: "month 6", value: 3514966 }, { name: "month 7", value: 1870398 }, { name: "month 8", value: 2628096 }, { name: "month 9", value: 1401138 }, { name: "month 10", value: 2322298 }, { name: "month 11", value: 16863216 }, { name: "month 12", value: 3198040 }], "bestsellers": [{ name: "Cartoon Network Studios Lime Flower Youngberry Gummies", price: "$459", unitsSold: 6178, revenue: 2835702 }, { name: "Magik Lamp Jasmine Flowers Cowberry Drops", price: "$416", unitsSold: 4323, revenue: 1798368 }, { name: "Profitpros Licorice, Liquorice Cocky Apple Snack", price: "$999", unitsSold: 3669, revenue: 3665331 }, { name: "Vermeer Industries Peppermint Raspberry Candy", price: "$556", unitsSold: 6852, revenue: 3809712 }, { name: "Gap Safflower European Blueberry Drops", price: "$270", unitsSold: 4743, revenue: 1280610 }, { name: "Drs Technologies Aniseed Myrtle Huckleberry Snack", price: "$290", unitsSold: 5824, revenue: 1688960 }, { name: "Estée Lauder Companies Licorice, Liquorice Amelanchier Drops", price: "$941", unitsSold: 4758, revenue: 4477278 }, { name: "Chargepal Cudweed Myrciaria Floribunda Drops", price: "$591", unitsSold: 8657, revenue: 5116287 }, { name: "Chrysler Pandan Flower Keule Cotton Candy", price: "$631", unitsSold: 8113, revenue: 5119303 }, { name: "S3 Graphics Jimbu Black Sapote Cotton Candy", price: "$930", unitsSold: 5377, revenue: 5000610 }, { name: "Iron Mountain Artemisia Lime Gummies", price: "$652", unitsSold: 4384, revenue: 2858368 }, { name: "Starbucks Avens Berberis Snack", price: "$497", unitsSold: 9266, revenue: 4605202 }, { name: "Starbucks Culantro Raisin Gum", price: "$273", unitsSold: 5990, revenue: 1635270 }, { name: "Greyvoid Artemisia Dodder Laurel Gum", price: "$620", unitsSold: 7687, revenue: 4765940 }, { name: "Better Business Ideas And Services Dorrigo Jostaberry Bar", price: "$448", unitsSold: 3333, revenue: 1493184 }, { name: "Chargepal Alligator Pepper Youngberry Gummies", price: "$670", unitsSold: 5585, revenue: 3741950 }, { name: "Asian Junction Salep Cocky Apple Pretzels", price: "$565", unitsSold: 3817, revenue: 2156605 }, { name: "Creative Wealth Management Catnip Calamansi Candy", price: "$768", unitsSold: 8356, revenue: 6417408 }, { name: "Enviro Architectural Designs Aniseed Myrtle Tomatillo Bar", price: "$491", unitsSold: 9114, revenue: 4474974 }, { name: "Lucasfilm Peruvian Pepper Date Snack", price: "$547", unitsSold: 3753, revenue: 2052891 }, { name: "Walmart Avens Keule Snack", price: "$532", unitsSold: 5815, revenue: 3093580 }, { name: "Cna Cicely, Sweet Cicely Desert Fig Cotton Candy", price: "$376", unitsSold: 3749, revenue: 1409624 }, { name: "Geico Curry Plant Calamansi Bar", price: "$901", unitsSold: 6906, revenue: 6222306 }, { name: "Washburn Guitars Saffron Myrciaria Floribunda Pretzels", price: "$410", unitsSold: 8610, revenue: 3530100 }, { name: "Jetblue Airways Barberry Melon Pear Snack", price: "$609", unitsSold: 9837, revenue: 5990733 }, { name: "Gamma Realty Peruvian Pepper Camu Camu Bar", price: "$200", unitsSold: 4737, revenue: 947400 }, { name: "Magik Lamp Lesser Calamint Banana Gummies", price: "$380", unitsSold: 6860, revenue: 2606800 }, { name: "Musco Lighting Cinnamon Myrtle Dwarf Dangleberry Gum", price: "$600", unitsSold: 9383, revenue: 5629800 }, { name: "Brown-Forman Corporation Caper Blood Orange Cotton Candy", price: "$130", unitsSold: 7620, revenue: 990600 }, { name: "Vaughan & Bushnell Manufacturing Licorice, Liquorice Citron Pretzels", price: "$888", unitsSold: 9677, revenue: 8593176 }]
    };

    httpClientSpy.get.and.returnValue(of(returnedDashboard));

    service.getDashboard().subscribe({
      next: Dashboard => {
        expect(Dashboard)
          .withContext('expected dashboard')
          .toEqual(expectedDashboard);
        done();
      },
      error: done.fail
    });
    expect(httpClientSpy.get.calls.count())
      .withContext('one call')
      .toBe(1);
  });
});

